version: '3'
services:
    php-fpm:
        build:
            context: ./php-fpm
            args:
                - INSTALL_APCU=${PHPFPM_INSTALL_APCU}
                - INSTALL_IMAGEMAGICK=${PHPFPM_INSTALL_IMAGICK}
                - INSTALL_XDEBUG=${PHPFPM_INSTALL_XDEBUG}
                - INSTALL_MONGO=${PHPFPM_INSTALL_MONGO}
                - INSTALL_ZIP_ARCHIVE=${PHPFPM_INSTALL_ZIP_ARCHIVE}
                - INSTALL_OPCACHE=${PHPFPM_INSTALL_OPCACHE}
            dockerfile: Dockerfile
        volumes:
            - './logs/xdebug/:/var/www/xdebug'
            - ${APP_CODE_PATH_HOST}:${APP_CODE_PATH_CONTAINER}
        expose:
            - '9000'
        extra_hosts:
            - 'dockerhost:${DOCKER_HOST_IP}'
        environment:
            - 'PHP_IDE_CONFIG=${PHP_IDE_CONFIG}'
        networks:
            - backend
    nginx:
        build:
            context: ./nginx
            args:
                - PHP_UPSTREAM=php-fpm
            dockerfile: Dockerfile
        volumes:
            - './logs/nginx/:/var/log/nginx'
            - ${APP_CODE_PATH_HOST}:${APP_CODE_PATH_CONTAINER}
        ports:
            - '${NGINX_HTTP_PORT}:80'
            - '${NGINX_HTTPS_PORT}:443'
        networks:
            - backend
            
networks:
    backend:
        driver: bridge
